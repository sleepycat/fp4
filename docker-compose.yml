name: fp4
services:
  # proxies localhost:3000 to containers based on rules in envoy.yaml
  envoy:
    image: envoyproxy/envoy-distroless-dev
    entrypoint: envoy
    command: [ "-l", "warn", "-c", "/etc/envoy.yaml", "--service-cluster", "envoy"]
    volumes:
      - ./envoy.yaml:/etc/envoy.yaml # Envoy configuration
    expose:
      - "3000" # Forward to proxied apps
      - "3001" # Envoy admin page
    ports:
      - "3000:3000"
      - "3001:3001"
  backend:
    build: ./backend
    env_file: ./backend/.env
    ports:
      - 3000
    expose:
      - 3000
    volumes:
    - type: bind
      source: ./backend
      target: /backend
  frontend:
    build: ./frontend
    ports:
      - 3000
    expose:
      - 3000
    command: npm run dev
    volumes:
      - type: bind
        source: ./frontend
        target: /frontend
volumes:
  driver: {}
